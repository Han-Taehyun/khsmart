<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ultarischool.school">


	<delete id="deleteCalOne" parameterType="String">
		delete from tsche where
		sn = #{sn}
	</delete>

	<select id="selectCalOne"
		resultType="com.ultarischool.notice.calendar" parameterType="String">
		SELECT
		sn,adminuid,customerid,cuhp,cuemail,cumemo,userid,

		ifnull(yyyy,'2020')
		yyyy,
		ifnull(mm,'01') mm,
		ifnull(dd,'01') dd,
		ifnull(hh,'10') hh,
		ifnull(mi,'0') mi,

		status,
		case
		when (
		DATEDIFF(str_to_date(concat(yyyy,'-',mm,'-',dd),'%Y-%m-%d') ,
		curdate()) ) > 0 then concat('+',(
		DATEDIFF(str_to_date(concat(yyyy,'-',mm,'-',dd),'%Y-%m-%d') ,
		curdate()) ))
		when 0 > (
		DATEDIFF(str_to_date(concat(yyyy,'-',mm,'-',dd),'%Y-%m-%d') ,
		curdate()) ) then concat('',(
		DATEDIFF(str_to_date(concat(yyyy,'-',mm,'-',dd),'%Y-%m-%d') ,
		curdate()) ))
		when (
		DATEDIFF(str_to_date(concat(yyyy,'-',mm,'-',dd),'%Y-%m-%d') ,
		curdate()) ) = 0 then concat('',(
		DATEDIFF(str_to_date(concat(yyyy,'-',mm,'-',dd),'%Y-%m-%d') ,
		curdate()) ))
		end ddd, prgcode
		from tsche where sn = #{sn}
	</select>



	<insert id="insertCalOne"
		parameterType="com.ultarischool.notice.calendar">
		insert into tsche (
		adminuid,customerid,cuhp,cuemail,cumemo,
		yyyy,mm,dd,hh,mi,status,prgcode,userid )
		values (
		#{adminuid},#{customerid},#{cuhp},#{cuemail},#{cumemo},
		#{yyyy},#{mm},#{dd},#{hh},#{mi},#{status},#{prgcode} ,#{userid})
	</insert>

	<update id="updateCalOne"
		parameterType="com.ultarischool.notice.calendar">
		update tsche set
		adminuid=#{adminuid},customerid=#{customerid},cuhp=#{cuhp},cuemail=#{cuemail},cumemo=#{cumemo},
		yyyy=#{yyyy},mm=#{mm},dd=#{dd},hh=#{hh},mi=#{mi},status=#{status},userid=#{userid}
		,prgcode=#{prgcode}
		where sn = #{sn}
	</update>

	<select id="selectCalList"
		resultType="com.ultarischool.notice.calendar">
		SELECT sn,adminuid,customerid,cuhp,cuemail,cumemo,userid,

		ifnull(yyyy,'2020') yyyy,
		ifnull(mm,'01') mm,
		ifnull(dd,'01') dd,
		ifnull(hh,'10') hh,
		ifnull(mi,'0') mi,

		status,
		case
		when (
		DATEDIFF(str_to_date(concat(yyyy,'-',mm,'-',dd),'%Y-%m-%d') ,
		curdate()) ) > 0 then concat('+',(
		DATEDIFF(str_to_date(concat(yyyy,'-',mm,'-',dd),'%Y-%m-%d') ,
		curdate()) ))
		when 0 > (
		DATEDIFF(str_to_date(concat(yyyy,'-',mm,'-',dd),'%Y-%m-%d') ,
		curdate()) ) then concat('',(
		DATEDIFF(str_to_date(concat(yyyy,'-',mm,'-',dd),'%Y-%m-%d') ,
		curdate()) ))
		when (
		DATEDIFF(str_to_date(concat(yyyy,'-',mm,'-',dd),'%Y-%m-%d') ,
		curdate()) ) = 0 then concat('',(
		DATEDIFF(str_to_date(concat(yyyy,'-',mm,'-',dd),'%Y-%m-%d') ,
		curdate()) ))
		end ddd,prgcode
		from tsche where hh != ''

	</select>

	<delete id="posts1Delete" parameterType="String">
		delete from
		tposts
		where
		sn=#{sn}
	</delete>






	<select id="selectPosts1One" parameterType="String"
		resultType="com.ultarischool.notice.Posts1VO">
		SELECT sn,userid,wdate,title,post,memo,imgfile from tposts
		where sn=#{sn}
	</select>





	<insert id="insertPosts1One"
		parameterType="com.ultarischool.notice.Posts1VO">
		insert into tposts (
		userid,wdate,title,post,memo,imgfile )
		values ( #{userid}
		,
		current_timestamp() , #{title},#{post},#{memo},#{imgfile})
	</insert>

	<insert id="updatePosts1One"
		parameterType="com.ultarischool.notice.Posts1VO">
		update tposts set userid=#{userid},
		imgfile=#{imgfile},title=#{title},post=#{post},memo=#{memo}

		where
		sn=#{sn}

	</insert>

	<insert id="updatePosts11One"
		parameterType="com.ultarischool.notice.Posts1VO">
		update tposts set userid=#{userid},
		title=#{title},post=#{post},memo=#{memo}

		where sn=#{sn}

	</insert>




	<sql id="includeposts1">
		WHERE sn != 0
		<if
			test="searchKeyword!=null and searchKeyword!='' and searchType!=''">
			<foreach item="item" index="index" collection="searchTypeArr"
				separator=" OR " open="AND (" close=")">
				${item} LIKE
				CONCAT('%',#{searchKeyword},'%' )
			</foreach>
		</if>

		<if test="orderKeyword=='1'">
			ORDER BY wdate DESC
		</if>
		<if test="orderKeyword=='2'">
			ORDER BY wdate DESC
		</if>
		<if test="orderKeyword=='' or orderKeyword==' '">
			ORDER BY wdate DESC
		</if>


	</sql>

	<sql id="includeposts2">
		WHERE 1 = 1
		<if
			test="searchKeyword!=null and searchKeyword!='' and searchType!=''">
			<foreach item="item" index="index" collection="searchTypeArr"
				separator=" OR " open="AND (" close=")">
				${item} LIKE
				CONCAT('%',#{searchKeyword},'%' )
			</foreach>
		</if>

		<if test="orderKeyword=='1'">
			ORDER BY regdate DESC
		</if>
		<if test="orderKeyword=='2'">
			ORDER BY regdate DESC
		</if>
		<if test="orderKeyword=='' or orderKeyword==' '">
			ORDER BY regdate DESC
		</if>


	</sql>




	<select id="selectPosts1Count" resultType="Integer"
		parameterType="com.ultarischool.notice.SearchVO">
		SELECT COUNT(*) FROM tposts
		<include refid="includeposts1" />
	</select>

	<select id="selectPosts1List"
		resultType="com.ultarischool.notice.Posts1VO"
		parameterType="com.ultarischool.notice.SearchVO">
		SELECT sn,userid,wdate,title,post,memo,imgfile from tposts
		<include refid="includeposts1" />

		LIMIT ${rowStart-1}, 10
	</select>
	
	
	<select id="selectB2BBoardCount" resultType="Integer"
		parameterType="com.ultarischool.notice.SearchVO">
		SELECT COUNT(*) FROM b2bboard
		where etcgoid = #{code2}
	</select>

	<select id="selectB2BBoardList"
		resultType="com.ultarischool.notice.Posts1VO"
		parameterType="com.ultarischool.notice.SearchVO">
		SELECT sn,etcgoid,wrid,btype,title,memo,vcnt,fileup,wdate from b2bboard
		
		
		where etcgoid = #{code2}

		LIMIT ${rowStart-1}, 10
	</select>
	
	<select id="selListB2B"
		resultType="com.ultarischool.notice.Posts1VO"
		parameterType="com.ultarischool.notice.SearchVO">
		SELECT sn , elsname FROM etcgo

	</select>
	
	

	<select id="selectStudyPosts1Count" resultType="Integer"
		parameterType="com.ultarischool.notice.SearchVO">
		SELECT COUNT(*) FROM
		( SELECT
		sp.sn,sp.coid,sp.userid,sp.regdate,heartnum,COMMENT,cs.title,ut.username
		FROM studypost sp JOIN course cs ON cs.sn = sp.coid
		JOIN usert ut ON
		ut.userid = sp.userid ) z
		<include refid="includeposts2" />
	</select>

	<select id="selectStudyPosts1List"
		resultType="com.ultarischool.notice.Posts1VO"
		parameterType="com.ultarischool.notice.SearchVO">
		SELECT
		sp.sn,sp.coid,sp.userid,sp.regdate,heartnum,COMMENT,cs.title,ut.username
		
		FROM studypost sp JOIN course cs ON cs.sn = sp.coid
		JOIN usert ut ON
		ut.userid = sp.userid

		<include refid="includeposts2" />

		LIMIT ${rowStart-1}, 10
	</select>



</mapper>


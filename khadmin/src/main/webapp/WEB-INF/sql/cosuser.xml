<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ultarischool.course">
	<select id="selectAllCourseUser"
		parameterType="com.ultarischool.course.CourseExample"
		resultType="com.ultarischool.course.CourseVO">
		SELECT cu.sn,courseid,cu.userid,billtype,wdate,
		cs.price orgprice,
		cu.price,tx,username, title
		FROM cosuser cu JOIN usert ut ON ut.userid
		= cu.userid
		JOIN course cs ON cs.sn = cu.courseid
		<if test="searchKeyword != null and searchKeyword != ''">
			WHERE c.${searchType} LIKE
			CONCAT('%',#{searchKeyword},'%')
		</if>
		LIMIT ${rowStart-1}, 10;
	</select>

	<select id="countAllCourseUser"
		parameterType="com.ultarischool.course.CourseExample"
		resultType="java.lang.Integer">
		SELECT COUNT(*) FROM

		(SELECT cu.sn,courseid,cu.userid,billtype,wdate,
		cs.price orgprice, cu.price,tx,username, title
		FROM cosuser cu JOIN
		usert ut ON ut.userid = cu.userid
		JOIN course cs ON cs.sn =
		cu.courseid) z
		<if test="searchKeyword != null and searchKeyword != ''">
			WHERE c.${searchType} LIKE
			CONCAT('%',#{searchKeyword},'%')
		</if>

	</select>

	<select id="selectAllPkgUser"
		parameterType="com.ultarischool.course.CourseExample"
		resultType="com.ultarischool.course.CourseVO">
		SELECT pu.sn,pkgid,pu.userid,wdate,price,billtype,username,pkgtitle
		FROM pkguser pu JOIN usert ut ON ut.userid = pu.userid JOIN package pk
		ON pk.sn = pu.pkgid
		<if test="searchKeyword != null and searchKeyword != ''">
			WHERE c.${searchType} LIKE
			CONCAT('%',#{searchKeyword},'%')
		</if>
		LIMIT ${rowStart-1}, 10;
	</select>

	<select id="countAllPkgUser"
		parameterType="com.ultarischool.course.CourseExample"
		resultType="java.lang.Integer">
		SELECT COUNT(*) FROM

		(SELECT
		pu.sn,pkgid,pu.userid,wdate,price,billtype,username,pkgtitle
		FROM
		pkguser pu JOIN usert ut ON ut.userid = pu.userid JOIN package pk ON
		pk.sn = pu.pkgid) z
		<if test="searchKeyword != null and searchKeyword != ''">
			WHERE c.${searchType} LIKE
			CONCAT('%',#{searchKeyword},'%')
		</if>

	</select>


	<select id="selectAllRateUser"
		parameterType="com.ultarischool.course.CourseExample"
		resultType="com.ultarischool.course.CourseVO">
		SELECT pg.sn,pg.coid,usid,chapid,studtime,pg.runtime,username,cs.title
		, cp.title cptitle, cp.runtime cpruntime,(ROUND(studtime / pg.runtime,1) * 100) rate
		FROM progress pg JOIN course cs ON cs.sn = pg.coid
		JOIN usert ut ON ut.userid = pg.usid
		JOIN chapter cp ON cp.coid = cs.sn AND pg.chapid = cp.sn
		<if test="searchKeyword != null and searchKeyword != ''">
			WHERE c.${searchType} LIKE
			CONCAT('%',#{searchKeyword},'%')
		</if>
		LIMIT ${rowStart-1}, 10;
	</select>

	<select id="countAllRateUser"
		parameterType="com.ultarischool.course.CourseExample"
		resultType="java.lang.Integer">
		SELECT COUNT(*) FROM

		(SELECT
		pg.sn,pg.coid,usid,chapid,studtime,pg.runtime,username,cs.title ,
		cp.title cptitle, cp.runtime cpruntime
		FROM progress pg JOIN course cs ON cs.sn = pg.coid
		JOIN usert ut ON ut.userid = pg.usid
		JOIN chapter cp ON cp.coid = cs.sn AND pg.chapid = cp.sn) z
		<if test="searchKeyword != null and searchKeyword != ''">
			WHERE c.${searchType} LIKE
			CONCAT('%',#{searchKeyword},'%')
		</if>

	</select>
</mapper>